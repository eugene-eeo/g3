#!/usr/bin/env python

import sys
import json
from path import Path

def main(path):
    base, ext = Path(path).splitext()
    if ext != '.md':
        return

    src = Path('_g3') / path
    dst = Path('_g3') / 'tmp' / base + '.header'

    with src.open('r') as f:
        b = []
        for line in f:
            if not line.strip():
                break
            b.append(line.rstrip())
        s = json.dumps(json.loads('\n'.join(b)))
        dir, _ = dst.splitpath()
        dir.makedirs_p()
        with dst.open('w') as g:
            g.write(s)


if __name__ == '__main__':
    main(sys.argv[1])
