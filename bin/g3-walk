#!/usr/bin/env python

from os.path import join
from pathlib import Path
from collections import deque
import json


def main():
    with open('_g3/config.json', 'r') as fp:
        config = json.load(fp)
        ignorelist = config.get('ignore', [])

    excluded_dirs = {Path('_g3/tmp'), Path('_g3/dst'), Path('_g3/static')}

    # BFS traversal of the directory
    q = deque([Path('_g3')])
    while q:
        p = q.popleft()
        if p.is_dir():
            if p in excluded_dirs:
                continue
            q.extend(p.iterdir())
            continue

        s = Path(join(*p.parts[1:]))
        if not any(p.match(pat) for pat in ignorelist):
            print(str(s))


if __name__ == '__main__':
    main()
